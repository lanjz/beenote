exports.ids=[2],exports.modules={65:function(t,e,o){var content=o(81);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);var d=o(6).default;t.exports.__inject__=function(t){d("5459e0b6",content,!0,t)}},66:function(t,e,o){var content=o(83);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);var d=o(6).default;t.exports.__inject__=function(t){d("0a81db27",content,!0,t)}},67:function(t,e,o){var content=o(85);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);var d=o(6).default;t.exports.__inject__=function(t){d("05cf2934",content,!0,t)}},68:function(t,e,o){var content=o(87);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);var d=o(6).default;t.exports.__inject__=function(t){d("6e12c256",content,!0,t)}},69:function(t,e,o){var content=o(89);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);var d=o(6).default;t.exports.__inject__=function(t){d("d0a00584",content,!0,t)}},70:function(t,e,o){var content=o(91);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);var d=o(6).default;t.exports.__inject__=function(t){d("44dbfe76",content,!0,t)}},71:function(t,e,o){var content=o(93);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);var d=o(6).default;t.exports.__inject__=function(t){d("9a8f7c16",content,!0,t)}},80:function(t,e,o){"use strict";o.r(e);var d=o(65),n=o.n(d);for(var c in d)"default"!==c&&function(t){o.d(e,t,function(){return d[t]})}(c);e.default=n.a},81:function(t,e,o){(t.exports=o(5)(!1)).push([t.i,'[data-v-7c521a1c]:root{--text-color:red}.catalogs-layout .catalogs-layout[data-v-7c521a1c]{padding-left:20px}.iconfont[data-v-7c521a1c]{font-size:25px;position:relative}.catalogs-item-layout[data-v-7c521a1c]{cursor:pointer;padding:7px 25px;position:relative;transition:.3s}.catalogs-item-layout .icon-open[data-v-7c521a1c]{display:none}.catalogs-item-layout .icon-close[data-v-7c521a1c]{display:block}.catalogs-item-layout[data-v-7c521a1c]:after{content:"";background:transparent;position:absolute;top:0;width:100%;height:100%;left:-100%;transition:.3s}.operate-triangle-btn[data-v-7c521a1c]{display:none;position:absolute;width:16px;height:16px;right:12px;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.operate-triangle-btn .iconfont[data-v-7c521a1c]{font-size:15px}.catalogs-item-layout .has-child[data-v-7c521a1c]{position:absolute;border-left:6px solid #919191;border-top:5px solid transparent;border-bottom:5px solid transparent;width:0;height:0;left:12px;top:50%;-webkit-transform:translateY(-6px);transform:translateY(-6px);transition:.2s}.catalogs-item-layout .has-child[data-v-7c521a1c]:after{content:"";width:20px;height:20px;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.catalogs-item-layout .has-child.in-chain[data-v-7c521a1c]{-webkit-transform:translateY(-6px) rotate(90deg);transform:translateY(-6px) rotate(90deg)}.catalogs-item-hover[data-v-7c521a1c]:hover{background:#404040;color:#ddd}.catalogs-item-hover:hover .operate-triangle-btn[data-v-7c521a1c]{display:block;color:#ddd}.catalogs-item-hover[data-v-7c521a1c]:hover:after{background:#404040}.catalogs-item-layout.act[data-v-7c521a1c]{background:#5f5f5f;color:#ddd}.catalogs-item-layout.act .icon-open[data-v-7c521a1c]{display:block}.catalogs-item-layout.act .icon-close[data-v-7c521a1c]{display:none}.catalogs-item-layout.act[data-v-7c521a1c]:after,.catalogs-item-layout.act[data-v-7c521a1c]:hover,.catalogs-item-layout.act[data-v-7c521a1c]:hover:after{background:#5f5f5f}.catalogs-name[data-v-7c521a1c],.edit-catalogs-input[data-v-7c521a1c]{position:relative;max-width:150px;padding:0 5px}.edit-catalogs-input[data-v-7c521a1c]{z-index:1;background:transparent;vertical-align:bottom;border:none;color:inherit;font-size:inherit;height:25px}.catalog-operate-layout[data-v-7c521a1c]{position:fixed;background:rgba(0,0,0,.8);left:50%;top:50%;color:#fff;z-index:999;border-radius:5px}.catalog-operate-layout .catalog-operate-item[data-v-7c521a1c]{width:150px;padding:10px 20px;position:relative}.catalog-operate-layout .catalog-operate-item[data-v-7c521a1c]:not(:last-child){border-bottom:1px solid hsla(0,0%,100%,.2)}.catalog-operate-layout .catalog-operate-item.hadChild[data-v-7c521a1c]:after{content:"";position:absolute;border-left:4px solid #fff;border-top:4px solid transparent;border-bottom:4px solid transparent;right:10px;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.catalog-operate-layout .catalog-operate-item:hover .operate-item-child[data-v-7c521a1c]{display:block}.catalog-operate-layout .operate-item-child[data-v-7c521a1c]{position:absolute;left:100%;top:0;width:100%;border-radius:0 5px 5px 0;background:rgba(0,0,0,.8);border-left:1px solid hsla(0,0%,100%,.2);display:none}.catalog-operate-layout .catalog-operate-item.builtIn[data-v-7c521a1c]{border-bottom:1px solid hsla(0,0%,100%,.6)}#hello_recent[data-v-7c521a1c]{font-size:24px}',""])},82:function(t,e,o){"use strict";o.r(e);var d=o(66),n=o.n(d);for(var c in d)"default"!==c&&function(t){o.d(e,t,function(){return d[t]})}(c);e.default=n.a},83:function(t,e,o){(t.exports=o(5)(!1)).push([t.i,'[data-v-7fb4985e]:root{--text-color:red}.article-item[data-v-7fb4985e]{padding:10px 20px;width:100%;cursor:pointer;position:relative;border-bottom:1px solid #000}.article-item .article-item-title[data-v-7fb4985e]{font-size:17px;color:#ddd}.article-item .article-item-mark[data-v-7fb4985e]{margin-top:7px;font-size:12px}.article-item .operate-icon[data-v-7fb4985e]{width:30px;height:30px;border-radius:50%;right:7px;top:7px;position:absolute;z-index:1;background:#5f5f5f;opacity:0;-webkit-transform:scale(0);transform:scale(0);transition:.3s;text-align:center;line-height:30px;color:#19181d}.article-item .operate-icon .iconfont[data-v-7fb4985e]{font-size:18px}.article-item .operate-icon[data-v-7fb4985e]:hover{background:#f4606c;color:#fff}.article-item:hover .operate-icon[data-v-7fb4985e]{opacity:1;-webkit-transform:scale(1);transform:scale(1)}.article-item.act[data-v-7fb4985e]{background:#19181d}.article-item.act[data-v-7fb4985e]:after{content:"";position:absolute;width:4px;height:100%;left:0;top:0;background:#afb0b1}.article-layout[data-v-7fb4985e]{padding:15px 0;background:#202020;color:#919191;max-width:500px;transition:.3s}.article-layout .article-min-width[data-v-7fb4985e]{min-width:200px}.article-layout.hidden-article[data-v-7fb4985e]{max-width:0;overflow:hidden}.article-layout-input-box[data-v-7fb4985e]{background:#5f5f5f;color:#ddd;width:90%;height:40px;padding:0 10px;position:relative;margin:0 auto 10px}.article-layout-input-box .iconfont[data-v-7fb4985e]{display:block;position:absolute;right:10px;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.article-layout-input[data-v-7fb4985e]{height:100%;border:none;background:transparent;display:inline-block;color:#ddd;outline:#fff;padding-right:46px}.article-label[data-v-7fb4985e]{margin:7px 0}.article-label-item[data-v-7fb4985e]{display:inline-block;padding:2px 5px;background:#5f5f5f;color:#202020;border-radius:2px;margin-bottom:3px;font-size:12px}.article-item-box[data-v-7fb4985e]{overflow-y:auto;overflow-x:hidden}',""])},84:function(t,e,o){"use strict";o.r(e);var d=o(67),n=o.n(d);for(var c in d)"default"!==c&&function(t){o.d(e,t,function(){return d[t]})}(c);e.default=n.a},85:function(t,e,o){(t.exports=o(5)(!1)).push([t.i,'[data-v-13d188fb]:root{--text-color:red}.content-list[data-v-13d188fb]{background:#fff;font-size:13px;position:relative}.content-list .content-list-item[data-v-13d188fb]{padding:10px;color:#2d2d2d;border-bottom:1px solid #adabab;position:relative;cursor:pointer}.content-list .content-list-item.act[data-v-13d188fb]{background:#fbfbfb}.content-list .content-list-item[data-v-13d188fb]:after{content:"";width:3px;height:100%;background:transparent;left:0;top:0;position:absolute;border-radius:0 2px 2px 0;transition:.3s}.content-list .content-list-item.act[data-v-13d188fb]:after{background:#398dee}.content-list .scroll-auto[data-v-13d188fb]{overflow:auto}.add-content-box[data-v-13d188fb]{height:60px;line-height:60px;text-align:center;position:absolute;bottom:0;left:0;width:100%;z-index:2;background:#fbfbfb;font-size:16px;color:#919191;cursor:pointer;transition:.3s;border-left:3px solid transparent}.add-content-box[data-v-13d188fb]:hover{background:#eee}.add-content-box.act[data-v-13d188fb]{border-left:3px solid #398dee}.form-label-layout[data-v-13d188fb]{width:auto}.form-group[data-v-13d188fb]:not(:first-child){margin-top:10px}.operate-icon[data-v-13d188fb]{width:30px;height:30px;border-radius:50%;right:7px;top:7px;position:absolute;z-index:1;background:#5f5f5f;opacity:0;-webkit-transform:scale(0);transform:scale(0);transition:.3s;text-align:center;line-height:30px;color:#19181d}.operate-icon .iconfont[data-v-13d188fb]{font-size:18px;color:#fff}.operate-icon[data-v-13d188fb]:hover{background:#f4606c;color:#fff}.content-list-item:hover .operate-icon[data-v-13d188fb]{opacity:1;-webkit-transform:scale(1);transform:scale(1)}.content-list-0[data-v-13d188fb]{font-size:16px}.is-done-layout[data-v-13d188fb]{position:absolute;border-color:transparent red red transparent;border-style:solid;border-width:20px;bottom:0;right:0;width:0;height:0;color:#fff;font-size:15px}.is-done-y[data-v-13d188fb]{border-right:20px solid #398dee;border-bottom:20px solid #398dee}.form-group[data-v-13d188fb]{overflow:hidden}',""])},86:function(t,e,o){"use strict";o.r(e);var d=o(68),n=o.n(d);for(var c in d)"default"!==c&&function(t){o.d(e,t,function(){return d[t]})}(c);e.default=n.a},87:function(t,e,o){(t.exports=o(5)(!1)).push([t.i,'[data-v-1b621aae]:root{--text-color:red}#codeMirror[data-v-1b621aae],.showCompileMarkdownBox[data-v-1b621aae]{width:100%;height:100%}.code-mirror .demo-split-pane[data-v-1b621aae]{padding:10px;overflow:auto}.code-mirror .showCompileMarkdownBox[data-v-1b621aae]{padding:0 7px;overflow:auto;word-break:break-all}.code-mirror .ivu-split-horizontal[data-v-1b621aae]{height:100%}.code-mirror .code-mirror-tags[data-v-1b621aae]{background:#202020;position:relative}.code-mirror .code-mirror-tags .tags-item[data-v-1b621aae]{border-bottom:1px solid #fff;position:relative;display:inline-block;padding:12px 15px;cursor:pointer}.code-mirror .code-mirror-tags .tags-item.act[data-v-1b621aae]{color:#515a6e;background:#fff;z-index:2}.code-mirror .code-mirror-tags .tags-item[data-v-1b621aae]:hover{color:#000}.code-mirror .code-mirror-tags .tags-item-2[data-v-1b621aae]{display:inline-block;float:right;cursor:pointer}.code-mirror .code-mirror-tags .tags-item-2.act[data-v-1b621aae]{background:#313131;color:#fff}.code-mirror .code-mirror-tags[data-v-1b621aae]:after{content:"";height:1px;background:#e1e4e8;position:absolute;width:100%;left:0;z-index:1;bottom:0}.markdown-layout .markdown-edit-box[data-v-1b621aae]{width:100%;height:100%;overflow:auto;padding:20px;background:#202020;color:#919191;border:none;outline:none;font-size:14px}.markdown-layout .md-body-layout[data-v-1b621aae]{overflow:auto;padding:20px;background:#fff;box-shadow:inset 0 0 4px 1px #e7eaef}.markdown-layout .markdown-operate-layout[data-v-1b621aae]{position:absolute;z-index:2;right:20px;top:10px;color:#fff}.markdown-layout .markdown-operate-layout .icon-layout[data-v-1b621aae]{display:inline-block;background:rgba(0,0,0,.7);padding:3px 5px;cursor:pointer;border-radius:3px;text-align:center}.markdown-layout .markdown-operate-layout .icon-layout.act[data-v-1b621aae]{background:rgba(57,141,238,.7)}',""])},88:function(t,e,o){"use strict";o.r(e);var d=o(69),n=o.n(d);for(var c in d)"default"!==c&&function(t){o.d(e,t,function(){return d[t]})}(c);e.default=n.a},89:function(t,e,o){(t.exports=o(5)(!1)).push([t.i,"[data-v-5c746514]:root{--text-color:red}.article-layout[data-v-5c746514]{background:#eee;position:relative}.article-layout .form-label-layout[data-v-5c746514]{width:100%;text-align:left;font-size:12px;color:#adabab;padding-left:0}.article-layout .form-content-layout[data-v-5c746514]{background:#fff;padding:7px 20px}.article-layout .add-options-item[data-v-5c746514]{margin:5px}.article-layout .form-input[data-v-5c746514],.article-layout .from-select[data-v-5c746514]{border:none;outline:none;padding:0}.article-layout .form-group[data-v-5c746514]:not(:first-child){margin:0}.article-layout .form-content-layout-select[data-v-5c746514]{padding-top:18px;padding-bottom:18px}.article-layout .markdown-layout[data-v-5c746514]{min-height:500px;position:relative;padding:10px}.article-layout-theme1 .article-content[data-v-5c746514]{padding:40px}.article-layout-theme1 .form-label-layout[data-v-5c746514]{display:none}.article-layout-theme1 .form-input[data-v-5c746514],.article-layout-theme1 .from-select[data-v-5c746514]{border:none;outline:none;font-size:20px}.article-title[data-v-5c746514]{border-bottom:1px solid #e1e4e8;background:#fff;height:45px;line-height:45px;padding:0 15px}.article-title .operate-list-operate .iconfont[data-v-5c746514]{font-size:20px;cursor:pointer}.article-title .operate-list-operate .icon-box[data-v-5c746514]{border:1px solid #919191;border-radius:50%;width:30px;height:30px;line-height:30px;text-align:center;display:inline-block}.article-title .operate-list-operate .icon-box.act[data-v-5c746514]{background:#398dee;color:#fff}.article-content[data-v-5c746514]{padding:7px}.full-input[data-v-5c746514]{font-size:17px;outline:none;color:#5f5f5f}.markdown .form-label-layout[data-v-5c746514]{display:none}.markdown .article-content[data-v-5c746514],.markdown .markdown-layout[data-v-5c746514]{padding:0}.markdown .scroll-box[data-v-5c746514]{overflow:hidden}.markdown .form-group[data-v-5c746514],.markdown .form-layout[data-v-5c746514]{height:100%}.article-content.noSave[data-v-5c746514]{border:1px solid #f4606c}.schema-operate-btn[data-v-5c746514]{height:30px;line-height:30px;width:80px;text-align:center;background:#202020;color:#fff;display:inline-block;border-radius:2px;font-size:14px;cursor:pointer}",""])},90:function(t,e,o){"use strict";o.r(e);var d=o(70),n=o.n(d);for(var c in d)"default"!==c&&function(t){o.d(e,t,function(){return d[t]})}(c);e.default=n.a},91:function(t,e,o){(t.exports=o(5)(!1)).push([t.i,"[data-v-3ee248cf]:root{--text-color:red}.controller-layout-fixed[data-v-3ee248cf]{position:fixed;bottom:50px;left:0;z-index:10}.controller-layout-fixed .controller-layout-item[data-v-3ee248cf]{width:30px;height:30px;line-height:30px;cursor:pointer;background:#919191;border-radius:0 20px 20px 0;margin-bottom:10px;text-align:center}.controller-layout-fixed .iconfont[data-v-3ee248cf]{font-size:18px}.controller-layout-fixed .controller-layout-item.act[data-v-3ee248cf]{background:#fff}",""])},92:function(t,e,o){"use strict";o.r(e);var d=o(71),n=o.n(d);for(var c in d)"default"!==c&&function(t){o.d(e,t,function(){return d[t]})}(c);e.default=n.a},93:function(t,e,o){(t.exports=o(5)(!1)).push([t.i,"[data-v-db1218fc]:root{--text-color:red}.book-slider-layout[data-v-db1218fc]{padding:15px;background:#2d2d2d}.book-layout[data-v-db1218fc]{margin-top:40px;width:38px;height:38px;cursor:pointer;position:relative;z-index:1}.book-layout .book-icon-layout[data-v-db1218fc]{line-height:38px;width:100%;height:100%;text-align:center;border-radius:50%;background:#fff;overflow:hidden;position:relative}.book-layout .iconfont[data-v-db1218fc]{font-size:26px}.book-layout .book-list-layout[data-v-db1218fc]{max-width:300px;padding:7px 20px;background:#2d2d2d;position:absolute;left:100%;top:0;transition:.3s;-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:0 15px;transform-origin:0 15px}.book-layout .book-list-layout .book-list-item-layout[data-v-db1218fc]{color:#fff;text-align:center}.book-layout .book-list-layout .book-list-item-layout .icon[data-v-db1218fc]{width:25px;height:25px;line-height:22px;border:1px solid #fff;border-radius:50%}.book-layout .book-list-layout .book-list-item-layout .icon .iconfont[data-v-db1218fc]{font-size:16px}.book-layout .book-list-layout .book-list-item-layout .book-name[data-v-db1218fc]{font-size:12px;margin-left:10px}.book-layout .book-list-layout .book-list-item-layout[data-v-db1218fc]:not(:last-child){margin-bottom:10px}.book-layout .book-list-layout .book-list-item-layout.act .icon[data-v-db1218fc]{border:1px solid #398dee;background:#398dee}.show-book-list:hover .book-list-layout[data-v-db1218fc]{-webkit-transform:scale(1);transform:scale(1)}.book-layout.act[data-v-db1218fc]{-webkit-transform:scale(1.2);transform:scale(1.2)}.book-layout.act .book-icon-layout[data-v-db1218fc]{background:#398dee}.book-layout.act .book-icon-layout .iconfont[data-v-db1218fc]{color:#fff}.book-layout[data-v-db1218fc]:not(:last-child){margin-bottom:10px}.catalog-layout[data-v-db1218fc]{padding:15px 2px;overflow:auto;background:#2d2d2d;color:#919191;width:200px;max-width:200px;transition:.3s}.hidden-catalog[data-v-db1218fc]{padding:15px 0;max-width:0;overflow:hidden}",""])},94:function(t,e,o){"use strict";o.r(e);var d=o(7),n=o(2),c=o(1),r=o(19),l=o(8),h={name:"TreeItem",props:{curNode:{type:Object,require:!0},isNewDir:{type:Boolean,default:function(){return!1}}},data:()=>({renameCatalog:!1,operateMenuStyle:{left:-1,top:"50%"},renameValue:"",newDir:{parentId:"",name:"新建文件夹",show:!1,isNew:!0},isOpen:!1}),computed:{...Object(d.mapState)({catalogs:t=>t.catalogs.list,actCatalog:t=>t.catalogs.curCatalog,schemaList:t=>Object.values(t.schema.list).filter(t=>t.fields.length),curBook:t=>t.books.curBook}),...Object(d.mapGetters)("catalogs",["treeChainList"]),hasChild(){return this.catalogs[this.curNode._id]&&this.catalogs[this.curNode._id].childNodes&&this.catalogs[this.curNode._id].childNodes.length}},watch:{curNode:{handler(){this.getDate()},deep:!0}},methods:{...Object(d.mapMutations)("catalogs",[n.CATALOGS_CUR_SAVE,n.CATALOGS_TEMPLATE_CREATE]),...Object(d.mapActions)("catalogs",[c.CATALOGS_GET,c.CATALOGS_PUT,c.CATALOGS_POST,c.CATALOGS_DELETE]),...Object(d.mapActions)("articles",[c.ARTICLE_RECENTLY_LIST_GET]),toggleOpenDir(){this.isOpen=!this.isOpen},async chooseCatalog(t){this.isOpen=!0,this[n.CATALOGS_CUR_SAVE](this.curNode._id),r.a.$emit("emitFromCatalog",t||{...this.curNode,catalogId:this.curNode._id})},async getRecentlyArticles(){this.$showLoading(),await this[c.ARTICLE_RECENTLY_LIST_GET](),this.$hideLoading(),this[n.CATALOGS_CUR_SAVE]("recently")},showOperateMenu(t){if(this.curNode.icon)return;const{clientX:e,clientY:o}=t;this.operateMenuStyle={top:`${o}px`,left:`${e}px`}},closeMenu(){this.operateMenuStyle.left=-1},todoRename(){this.renameValue=this.curNode.name,this.closeMenu(),this.renameCatalog=!0},todoCreateFile(t){this.chooseCatalog({schemaId:t._id,catalogId:this.curNode._id,isNew:!0}),this.closeMenu()},todoDelete(){this.closeMenu(),this.$alert({title:`你确认要删除"${this.curNode.name}"`}).then(async t=>{this.doDeleteCatalog()})},async doDeleteCatalog(){this.$showLoading();const t=await this[c.CATALOGS_DELETE]({_id:this.curNode._id});this.$hideLoading(),t.err||(this.$toast({title:"删除成功"}),await this.getDate(this.curNode,!0))},doRename(){this.renameCatalog=!1,this.isNewDir?this.addCatalog(this.renameValue,this.curNode.parentId):this.renameValue&&this.renameValue!==this.curNode.name&&this.modifyCatalogName(this.renameValue,this.curNode)},submitCatalogName(t,e){const{isNew:o}=e;o?this.addCatalog(t,e):this.modifyCatalogName(t,e)},async modifyCatalogName(t,e){const{_id:o,parentId:d}=e;(await this[c.CATALOGS_PUT]({_id:o,name:t,parentId:d})).err||this.getDate(e,!0)},async addCatalog(t,e){await this[c.CATALOGS_POST]({parentId:e,name:t,bookId:this.curBook});this.$emit("emitExitNewDir")},exitNewDir(){this.getDate(this.curNode,!0),this.newDir.parentId=""},doCreateTemDir(){this.isOpen=!0,this.closeMenu(),this.newDir.parentId=this.curNode._id,this.newDir.parentParentId=this.curNode.parentId},async getDate(t,e){const o=t||this.curNode;await this[c.CATALOGS_GET]({parentId:e?o.parentId||"root":o._id,bookId:this.curBook})},init(){this.isNewDir?this.todoRename():this.curNode.hasChild&&this.getDate(),document.addEventListener("click",t=>{this.$el.contains(t.target)})}},mounted(){this.init()}},f=o(4);var v={name:"Tree",components:{TreeItem:Object(f.a)(h,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"catalogs-layout"},[t._ssrNode("<div"+t._ssrClass("flex align-items-center catalogs-item-layout",{act:t.actCatalog===t.curNode._id,"catalogs-item-hover":!(t.isNewDir||t.renameCatalog)})+" data-v-7c521a1c>","</div>",[t._ssrNode((t.catalogs[t.curNode._id]&&t.hasChild?"<div"+t._ssrClass("has-child",{"in-chain":t.isOpen||t.isOpen&&t.hasChild&&t.treeChainList&&t.treeChainList.indexOf(t.curNode._id)>-1})+" data-v-7c521a1c></div>":"\x3c!----\x3e")+" "+(t.curNode.icon?"<i"+t._ssrAttr("id",t.curNode._id)+t._ssrClass("iconfont",t.curNode.icon)+" data-v-7c521a1c></i>":t.treeChainList&&t.treeChainList.indexOf(t.curNode._id)>-1?"<i"+t._ssrAttr("id",t.curNode._id)+t._ssrClass("iconfont icon-wenjianjia",t.curNode.icon)+" data-v-7c521a1c></i>":"<i"+t._ssrAttr("id",t.curNode._id)+' class="iconfont icon-wendang1" data-v-7c521a1c></i>')+" "),t.curNode.isNew||t.renameCatalog?o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.renameValue,expression:"renameValue",modifiers:{trim:!0}},{name:"focus",rawName:"v-focus:select",arg:"select"}],staticClass:"edit-catalogs-input line-ellipsis",domProps:{value:t.renameValue},on:{blur:[t.doRename,function(e){return t.$forceUpdate()}],input:function(e){e.target.composing||(t.renameValue=e.target.value.trim())}}},[]):t._ssrNode('<div class="catalogs-name line-ellipsis" data-v-7c521a1c>'+t._ssrEscape(t._s(t.curNode.name))+"</div>"),t._ssrNode(" "+(t.curNode.icon?"\x3c!----\x3e":'<div class="operate-triangle-btn" data-v-7c521a1c><i class="iconfont icon-tianjiajiahaowubiankuang" data-v-7c521a1c></i></div>')+" "),-1!==t.operateMenuStyle.left?o("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.closeMenu,expression:"closeMenu"}],staticClass:"catalog-operate-layout",style:t.operateMenuStyle},[t._ssrNode('<div class="catalog-operate-item hadChild" data-v-7c521a1c>\n        新建文件\n        <div class="operate-item-child" data-v-7c521a1c>'+t._ssrList(t.schemaList,function(e,o){return"<div"+t._ssrClass("catalog-operate-item",{builtIn:e.builtIn})+" data-v-7c521a1c>"+t._ssrEscape(t._s(e.name))+"</div>"})+'</div></div> <div class="catalog-operate-item" data-v-7c521a1c>新建文件夹</div> '+("root"!==t.curNode._id?'<div class="catalog-operate-item" data-v-7c521a1c>重命名</div>':"\x3c!----\x3e")+" "+("root"!==t.curNode._id?'<div class="catalog-operate-item" data-v-7c521a1c>删除</div>':"\x3c!----\x3e"))]):t._e()],2),t._ssrNode(" "),t.catalogs[t.curNode._id]&&t.catalogs[t.curNode._id].childNodes&&t.catalogs[t.curNode._id].childNodes.length?t._ssrNode("<div data-v-7c521a1c>","</div>",t._l(t.catalogs[t.curNode._id].childNodes,function(e,d){return o("TreeItem",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"}],key:d,attrs:{curNode:e}})}),1):t._e(),t._ssrNode(" "),t.newDir.parentId===t.curNode._id?o("TreeItem",{attrs:{curNode:t.newDir,isNewDir:t.newDir.parentId===t.curNode._id},on:{emitExitNewDir:t.exitNewDir}}):t._e()],2)},[],!1,function(t){var e=o(80);e.__inject__&&e.__inject__(t)},"7c521a1c","52ebc2f5").exports},data:()=>({catalogList:[{_id:l.a.recentlyArticlesKey,name:"最近文档",hasChild:!1,icon:"icon-wendang"},{_id:"root",name:"我的文件夹",hasChild:!0}]})};var m=Object(f.a)(v,function(){var t=this.$createElement,e=this._self._c||t;return e("div",this._l(this.catalogList,function(t,o){return e("TreeItem",{key:t._id,attrs:{curNode:t,treeChain:[t._id]}})}),1)},[],!1,function(t){},"04184fe2","106400fe").exports,_={props:{list:{type:Array,default:()=>[]},cusArticle:""},data:()=>({filterKeys:""}),computed:{...Object(d.mapState)({showBrief:t=>t.config.showBrief,bookList:t=>t.books.list,schemaList:t=>t.schema.list,filterList:function(){return this.filterKeys?this.list.filter(t=>t.title.indexOf(this.filterKeys)>-1):this.list}})},filters:{getBookName:function(t,e){return e[t]?e[t].name:""},getCatalogsName:function(t,e){return e[t]?e[t].name:""}},methods:{...Object(d.mapActions)("articles",[c.ARTICLE_DELETE]),chooseArticles:function(t){this.$emit("emitToChooseCurArticle",{schemaId:t.schemaId,articleId:t._id,catalogId:t.catalogId})},todoDelete(t){this.$alert({title:`你确认要删除"${t.title}"`}).then(async e=>{e&&this.doDeleteArticle(t)})},async doDeleteArticle(t={}){this.$showLoading();const e=await this[c.ARTICLE_DELETE](t._id);this.$hideLoading(),e.err||this.$toast({title:"删除成功"}),this.$emit("emitInitArticle",{schemaId:t.schemaId,catalogId:t.catalogId})}}};var x=Object(f.a)(_,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"article-layout box-shadow flex direction-column",class:{"hidden-article":!t.showBrief}},[t._ssrNode('<div class="flex-1 flex direction-column article-min-width" data-v-7fb4985e><div class="article-layout-input-box align-items-center" data-v-7fb4985e><input type="text"'+t._ssrAttr("value",t.filterKeys)+' class="article-layout-input" data-v-7fb4985e> <i class="iconfont icon-sousuo" data-v-7fb4985e></i></div> <div class="flex-1 article-item-box" data-v-7fb4985e>'+t._ssrList(t.filterList,function(e,o){return"<div"+t._ssrClass("article-item",{act:e._id===t.cusArticle})+' data-v-7fb4985e><div class="article-item-title" data-v-7fb4985e>'+t._ssrEscape(t._s(e.title))+'</div> <div class="article-label" data-v-7fb4985e><span class="article-label-item" data-v-7fb4985e>'+t._ssrEscape(t._s(t._f("getBookName")(e.bookId,t.bookList)))+'</span> <span class="article-label-item" data-v-7fb4985e>'+t._ssrEscape(t._s(t._f("getCatalogsName")(e.schemaId,t.schemaList)))+'</span></div> <div class="article-item-mark" data-v-7fb4985e>'+t._ssrEscape(t._s(t._f("timestampToBriefTime")(e.createTime))+"~"+t._s(t._f("timestampToBriefTime")(e.updateTime)))+'</div> <div class="operate-icon" data-v-7fb4985e><i class="iconfont icon-shanchu1" data-v-7fb4985e></i></div></div>'})+"</div></div>")])},[],!1,function(t){var e=o(82);e.__inject__&&e.__inject__(t)},"7fb4985e","2c41da58").exports,y={props:["fields","contentList","curContentId"],filters:{},computed:{findDone:function(){return this.fields.find(t=>t.isDone)}},methods:{textareaFormat:t=>t?t.replace(/\n|\r\n/g,"<br>"):"",todoAddContent(){this.$emit("focusContent")},focusContent(t){this.$emit("focusContent",{...t})},todoDelete(t){this.$alert({title:"你确认要删除此内容"}).then(async e=>{e&&this.$emit("emitDeleteItem",{...t})})}}};var w=Object(f.a)(y,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"content-list  flex flex-1 direction-column"},[t._ssrNode('<div class="flex-1 relative" data-v-13d188fb><div class="absolute-full scroll-auto" data-v-13d188fb>'+t._ssrList(t.contentList,function(e,o){return t.contentList&&t.contentList.length?"<div"+t._ssrClass("content-list-item",{act:t.curContentId===e._id})+' data-v-13d188fb><div class="operate-icon" data-v-13d188fb><i class="iconfont icon-shanchu1" data-v-13d188fb></i></div> '+(t.fields&&t.fields.length?'<div class="form-layout theme-1" data-v-13d188fb>'+t._ssrList(t.fields,function(o,d){return"<div"+t._ssrAttr("index",d)+t._ssrClass("form-group flex","content-list-"+d)+' data-v-13d188fb><div class="form-label-layout" data-v-13d188fb>'+t._ssrEscape("\n             "+t._s(o.name)+"：\n           ")+"</div> "+("markdown"===o.type?'<div class="flex flex-1 align-items-center form-content-layout markdown-layout" data-v-13d188fb>'+t._ssrEscape("\n             "+t._s(e[o._id]||"无")+"\n           ")+"</div>":"\x3c!----\x3e")+" "+("input"===o.type?'<div class="flex flex-1 align-items-center form-content-layout" data-v-13d188fb>'+t._ssrEscape("\n             "+t._s(e[o._id]||"无")+"\n           ")+"</div>":"\x3c!----\x3e")+" "+("textarea"===o.type?'<div class="flex flex-1 align-items-center form-content-layout" data-v-13d188fb>'+t._s(t.textareaFormat(e[o._id]))+"</div>":"\x3c!----\x3e")+" "+("radio"===o.type?'<div class="flex flex-1 align-items-center form-content-layout" data-v-13d188fb>'+t._ssrList(o.options,function(d,n){return d.id===e[o._id]?"<div"+t._ssrClass("add-options-item",{act:d.id===e[o._id]})+" data-v-13d188fb>"+t._ssrEscape("\n               "+t._s(d.name)+"\n             ")+"</div>":"\x3c!----\x3e"})+" "+(e[o._id]?"\x3c!----\x3e":"<div data-v-13d188fb>无</div>")+"</div>":"\x3c!----\x3e")+" "+("select"===o.type?'<div class=" form-content-layout flex flex-1 align-items-center " data-v-13d188fb>'+t._ssrList(o.options,function(d,n){return"[object Array]"===Object.prototype.toString.call(e[o._id])&&e[o._id].indexOf(d.id)>-1?"<div"+t._ssrClass(null,{act:"[object Array]"===Object.prototype.toString.call(e[o._id])&&e[o._id].indexOf(d.id)>-1})+' data-v-13d188fb><div class=" flex align-items-center" data-v-13d188fb><div data-v-13d188fb>'+t._ssrEscape(t._s(d.name))+"</div></div></div>":"\x3c!----\x3e"})+" "+(e[o._id]&&e[o._id].length?"\x3c!----\x3e":"<div data-v-13d188fb>无</div>")+"</div>":"\x3c!----\x3e")+" "+(t.findDone&&t.findDone._id===o._id?"<div"+t._ssrClass("is-done-layout",{"is-done-y":t.findDone.isDone===e[o._id]})+" data-v-13d188fb>"+(t.findDone.isDone===e[o._id]?"<div data-v-13d188fb>Y</div>":"<div data-v-13d188fb>N</div>")+"</div>":"\x3c!----\x3e")+"</div>"})+"</div>":"\x3c!----\x3e")+"</div>":"\x3c!----\x3e"})+"</div></div> <div"+t._ssrClass("add-content-box",{act:"new"===t.curContentId})+" data-v-13d188fb>添加内容</div>")])},[],!1,function(t){var e=o(84);e.__inject__&&e.__inject__(t)},"13d188fb","92dc1a1e").exports,C=o(59),k=o.n(C),I=o(60),A=o.n(I);k.a.setOptions({renderer:new k.a.Renderer,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,highlight:function(code){return A.a.highlightAuto(code).value}});var L={model:{prop:"data",event:"update"},props:{data:String},data:()=>({split:.5,markDownValue:"",editMode:1,isEdit:!0,isPreview:!0,markdownHTML:""}),watch:{markDownValue:function(t){this.markdownHTML=k()(t),this.$emit("update",t)}},methods:{toggleEdit(){this.isEdit=!this.isEdit,this.isEdit||(this.isPreview=!0)},togglePreview(){this.isPreview=!this.isPreview,this.isPreview||(this.isEdit=!0)}},mounted(){this.markDownValue=this.data||""}};var E=Object(f.a)(L,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"code-mirror absolute-full flex direction-column markdown-layout"},[t._ssrNode("<div"+t._ssrClass("flex-1 flex relative",{hideSplit:3!==t.editMode})+' data-v-1b621aae><div class="markdown-operate-layout" data-v-1b621aae><div'+t._ssrClass("icon-layout",{act:t.isEdit})+' data-v-1b621aae><i class="iconfont icon-bianji2" data-v-1b621aae></i></div> <div'+t._ssrClass("icon-layout",{act:t.isPreview})+' data-v-1b621aae><i class="iconfont icon-yulan" data-v-1b621aae></i></div></div> '+(t.isEdit?'<div class="flex-1 relative" data-v-1b621aae><textarea class="markdown-edit-box box-shadow-inset" data-v-1b621aae>'+t._ssrEscape(t._s(t.markDownValue))+"</textarea></div>":"\x3c!----\x3e")+" "+(t.isPreview?'<div class="flex-1 md-body-layout edit-layout relative" data-v-1b621aae><div class="markdown-style" data-v-1b621aae>'+t._s(t.markdownHTML)+"</div></div>":"\x3c!----\x3e")+"</div>")])},[],!1,function(t){var e=o(86);e.__inject__&&e.__inject__(t)},"1b621aae","52af9afa").exports,N={props:{editMeta:{type:Object}},data:function(){return{articleName:"未命名",cacheName:"未命名",contents:{},editId:"new",schemaId:"",catalogId:"",test:"123",fields:[],contentList:[],cacheContents:{},isEditContents:!1,showList:!1,showEditContent:!1}},components:{MarkdownEdit:E,articleContentList:w},computed:{...Object(d.mapState)({catalogs:t=>t.catalogs.list,bookList:t=>t.books.list,articles:t=>t.articles.list}),dataHasChange(){return JSON.stringify(this.contents)!==JSON.stringify(this.cacheContents)}},watch:{editMeta:function(t){this.setMeta(t)},editId:function(t){this[n.ARTICLE_CUS_SAVE](t)}},methods:{...Object(d.mapMutations)("articles",[n.ARTICLE_CUS_SAVE]),...Object(d.mapMutations)("books",[n.BOOK_CUR_UPDATE]),...Object(d.mapActions)("articles",[c.ARTICLE_DES_GET,c.ARTICLE_POST,c.ARTICLE_PUT,c.ARTICLE_CONTENT_PUT,c.ARTICLE_CONTENT_POST,c.ARTICLE_CONTENT_DELETE]),async setMeta(t){const{editId:e,fields:o,_id:d,catalogId:n,content:content,title:title,list:c}=t;this.editId=e,this.schemaId=d,this.catalogId=n,(this.articleName="new"===e||!c)&&(this.fields=[]),setTimeout(()=>{this.getContentList(),this.cacheName=this.articleName="new"===e?"未命名":title,this.showList=c||!1,this.fields=[...o],this.contents=this.initContent(this.fields,content),this.cacheContents=JSON.parse(JSON.stringify(this.contents))})},initContent:(t,e)=>(t&&t.length&&t.forEach(t=>{e[t._id]||(e[t._id]=t.default?t.default:"")}),e),todoEditContent(t){this.showEditContent=!0;const content=t||{_id:"new"},e={editId:this.editId,_id:this.schemaId,catalogId:this.catalogId,fields:this.fields,title:this.articleName,list:this.showList,content:content};this.setMeta(e)},async doDeleteContent(t){this.$showLoading();const e=await this[c.ARTICLE_CONTENT_DELETE]({articleId:this.editId,contentId:t._id});this.$hideLoading(),e.err||(this.$toast({title:"删除成功"}),this.$emit("emitUpdateArticle",{schemaId:this.schemaId,catalogId:this.catalogId,articleId:this.editId}))},getContentList(){if("new"===this.editId)return void(this.contentList=[]);const data=this.articles[this.editId].contents;return this.contentList=[...data],data},changeSelect(t,e){"[object Array]"!==Object.prototype.toString.call(this.contents[t])&&(this.contents[t]=[]);const o=this.contents[t].indexOf(e.id);o>-1?this.contents[t].splice(o,1):([...this.contents[t]].push(e.id),this.contents[t].push(e.id),this.contents=JSON.parse(JSON.stringify(this.contents)))},toggleList(){this.showList=!this.showList,this.articleName||(this.articleName=this.cacheName),this.todoEdit(!0)},async todoEdit(t=!1){if(!(t||this.articleName&&"new"!==this.editId&&this.cacheName!==this.articleName))return;if(this.$showLoading(),!(await this[c.ARTICLE_PUT]({_id:this.editId,content:this.contents,title:this.articleName,list:this.showList})).err){this.$toast({title:"保存成功"});const t=this.editId;await this.getData(t,!0),this.$emit("emitUpdateArticle",{schemaId:this.schemaId,catalogId:this.catalogId,articleId:t,getData:"getArticleByCatalogId"})}this.$hideLoading()},async todoSave(){if(!this.articleName)return;this.$showLoading();const t=await this[c.ARTICLE_POST]({schemaId:this.schemaId,catalogId:this.catalogId,content:this.contents,title:this.articleName});if(!t.err){this.$toast({title:"添加成功"});const e=t.data.id;await this.getData(e,!0),this.$emit("emitUpdateArticle",{schemaId:this.schemaId,catalogId:this.catalogId,articleId:e,getData:"getArticleByCatalogId"})}this.$hideLoading()},async getData(t,e=!1){this.editId=t,this.$showLoading();const o=await this[c.ARTICLE_DES_GET]({_id:t,force:e});if(!o.err){const{bookId:t,catalogId:e}=o.data,{MOCK:d}=process.env;d||this[n.BOOK_CUR_UPDATE](t)}this.$hideLoading()},async toDoSaveArticleContent(){if(!this.dataHasChange||"new"===this.editId)return;this.isEditContents=!1,this.$showLoading();let t="",e="";if("new"===this.contents._id?e=await this[c.ARTICLE_CONTENT_POST]({_id:this.editId,content:this.contents}):(e=await this[c.ARTICLE_CONTENT_PUT]({_id:this.editId,content:this.contents}),t=this.contents._id),this.$hideLoading(),!e.err){const t="new"===this.contents._id?"添加成功":"保存成功";this.$toast({title:t})}this.$emit("emitUpdateArticle",{schemaId:this.schemaId,catalogId:this.catalogId,articleId:this.editId,contentId:t})},async init(){const{id:t}=this.$route.params;t&&(this.editId=t,await this.getData(t))}},mounted(){this.init()}};var article=Object(f.a)(N,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"article-layout flex direction-column flex-1",class:t.editMeta._id},[t._ssrNode('<div class="article-title flex " data-v-5c746514><div class="flex-1 schema-title-layout relative" data-v-5c746514><input'+t._ssrAttr("value",t.articleName)+' class="full-input" data-v-5c746514></div> <div class="schema-operate" data-v-5c746514>'+("new"===t.editId?"<span"+t._ssrClass("schema-operate-btn",{"disable-btn":!t.articleName})+" data-v-5c746514>保存</span>":'<div class="operate-list-operate" data-v-5c746514>'+(t.showList?"<div"+t._ssrClass("icon-box",{act:t.showEditContent})+' data-v-5c746514><i class="iconfont icon-zuoye1" data-v-5c746514></i></div>':"\x3c!----\x3e")+" <div"+t._ssrClass("icon-box",{act:t.showList})+' data-v-5c746514><i class="iconfont icon-liebiao3" data-v-5c746514></i></div></div>')+"</div></div> "),t._ssrNode('<div class="flex-1 flex" data-v-5c746514>',"</div>",[o("div",{directives:[{name:"show",rawName:"v-show",value:t.showList&&t.showEditContent||!t.showList,expression:"(showList&&showEditContent)||!showList"},{name:"click-outside",rawName:"v-click-outside",value:t.toDoSaveArticleContent,expression:"toDoSaveArticleContent"}],staticClass:"article-content relative flex-1 flex",class:{noSave:t.dataHasChange},on:{click:function(e){t.isEditContents=!0}}},[t._ssrNode('<div class="flex-1 relative" data-v-5c746514>',"</div>",[t._ssrNode('<div class="scroll-box" data-v-5c746514>',"</div>",[t.fields&&t.fields.length?t._ssrNode('<div class="form-layout theme-1" data-v-5c746514>',"</div>",t._l(t.fields,function(e,d){return t._ssrNode("<div"+t._ssrAttr("index",d)+' class="form-group flex direction-column" data-v-5c746514>',"</div>",[t._ssrNode('<div class="form-label-layout" data-v-5c746514>'+t._ssrEscape("\n                "+t._s(e.name)+"：\n              ")+"</div> "),"markdown"===e.type?t._ssrNode('<div class="flex flex-1 align-items-center form-content-layout markdown-layout" data-v-5c746514>',"</div>",[o("markdown-edit",{model:{value:t.contents[e._id],callback:function(o){t.$set(t.contents,e._id,o)},expression:"contents[field._id]"}})],1):t._e(),t._ssrNode(" "+("input"===e.type?'<div class="flex flex-1 align-items-center form-content-layout" data-v-5c746514><input'+t._ssrAttr("placeholder","填写"+e.name)+t._ssrAttr("value",t.contents[e._id])+' class="form-input" data-v-5c746514></div>':"\x3c!----\x3e")+" "+("textarea"===e.type?'<div class="flex flex-1 align-items-center form-content-layout" data-v-5c746514><textarea type="text" class="form-input" data-v-5c746514>'+t._ssrEscape(t._s(t.contents[e._id]))+"</textarea></div>":"\x3c!----\x3e")+" "+("radio"===e.type?'<div class="flex flex-1 align-items-center form-content-layout" data-v-5c746514>'+t._ssrList(e.options,function(o,d){return"<div"+t._ssrClass("add-options-item radio-style",{act:o.id===t.contents[e._id]})+" data-v-5c746514>"+t._ssrEscape("\n                  "+t._s(o.name)+"\n                  ")+'<input type="radio"'+t._ssrAttr("value",o.id)+t._ssrAttr("checked",t._q(t.contents[e._id],o.id))+' class="form-radio" data-v-5c746514></div>'})+"</div>":"\x3c!----\x3e")+" "+("select"===e.type?'<div class=" form-content-layout form-content-layout-select" data-v-5c746514>'+t._ssrList(e.options,function(o,d){return"<div"+t._ssrClass("select-style",{act:"[object Array]"===Object.prototype.toString.call(t.contents[e._id])&&t.contents[e._id].indexOf(o.id)>-1})+' data-v-5c746514><div class=" flex align-items-center" data-v-5c746514><div class="select-iconfont" data-v-5c746514><i class="iconfont icon-gou" data-v-5c746514></i></div> <div data-v-5c746514>'+t._ssrEscape(t._s(o.name))+'</div></div> <input type="checkBox"'+t._ssrAttr("value",o.id)+' class="form-radio" data-v-5c746514></div>'})+"</div>":"\x3c!----\x3e"))],2)}),0):t._e()])])]),t._ssrNode(" "),t.showList?t._ssrNode('<div class="flex flex-1 relative" data-v-5c746514>',"</div>",[o("article-content-list",{attrs:{fields:t.fields,contentList:t.contentList,curContentId:t.contents._id},on:{focusContent:t.todoEditContent,emitDeleteItem:t.doDeleteContent}})],1):t._e()],2)],2)},[],!1,function(t){var e=o(88);e.__inject__&&e.__inject__(t)},"5c746514","46f56096").exports,T={name:"articleFixed",computed:{...Object(d.mapState)({showDir:t=>t.config.showDir,showBrief:t=>t.config.showBrief})},methods:{...Object(d.mapMutations)("config",[n.CONFIG_TOGGLE_SAVE]),doSetConfig(t){this[n.CONFIG_TOGGLE_SAVE]({tar:t,val:!this[t]})}},mounted(){this.doSetConfig("showDir",!0),this.doSetConfig("showBrief",!0)}};var O={components:{TreeItem:m,ArticleBrief:x,articles:article,articleFixed:Object(f.a)(T,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"controller-layout-fixed"},[this._ssrNode("<div"+this._ssrClass("controller-layout-item",{act:this.showDir})+' data-v-3ee248cf><i class="iconfont icon-neirong" data-v-3ee248cf></i></div> <div'+this._ssrClass("controller-layout-item",{act:this.showBrief})+' data-v-3ee248cf><i class="iconfont icon-shujia1" data-v-3ee248cf></i></div>')])},[],!1,function(t){var e=o(90);e.__inject__&&e.__inject__(t)},"3ee248cf","40b97ea4").exports},data:function(){return{editMeta:{editId:""},curArticleList:[],cusArticle:""}},computed:{...Object(d.mapState)({schemaList:t=>t.schema.list,articleList:t=>t.articles.catalogMapArticles,curBook:t=>t.books.curBook,articles:t=>t.articles.list,showDir:t=>t.config.showDir}),...Object(d.mapGetters)("catalogs",["treeChainList"])},methods:{...Object(d.mapMutations)("catalogs",[n.CATALOGS_CUR_SAVE]),...Object(d.mapActions)("books",[c.BOOK_LIST_GET]),...Object(d.mapActions)("schema",[c.SCHEMA_LIST_GET]),...Object(d.mapActions)("articles",[c.ARTICLE_RECENTLY_LIST_GET,c.ARTICLE_LIST_GET,c.ARTICLE_DES_GET]),...Object(d.mapActions)("catalogs",[c.CATALOGS_GET]),async getBookData(){Promise.all([this[c.BOOK_LIST_GET](),this[c.SCHEMA_LIST_GET](),this[c.CATALOGS_GET]({parentId:"root",bookId:this.curBook})]).then(()=>{this[c.ARTICLE_RECENTLY_LIST_GET]().then(()=>{this.doShowArticleFromCatalog({catalogId:l.a.recentlyArticlesKey})})}).catch(t=>{console.log("err",t),this.$alert({title:"getBookData",content:t.message})})},async chooseCurArticle(t){const{catalogId:e,schemaId:o,articleId:d,contentId:n=""}=t;this.cusArticle=d,this.setEditMeta(e,o,d,n)},async doCreateArticle(t){const{catalogId:e,schemaId:o}=t;await this.getArticleByCatalogId(e),this.setEditMeta(e,o,"new")},async doUpdateArticle(t){const{catalogId:e,articleId:o,contentId:d="",schemaId:n,getData:c=""}=t;"getArticleByCatalogId"===c&&await this.getArticleByCatalogId(e),await this.getData(o,!0),this.chooseCurArticle({catalogId:e,schemaId:n,articleId:o,contentId:d})},async doShowArticleFromCatalog(t){const{catalogId:e,articleId:o,contentId:d=""}=t;if(await this.getArticleByCatalogId(e),this.curArticleList&&this.curArticleList.length){const{catalogId:t,schemaId:e}=this.curArticleList[0];this.chooseCurArticle({catalogId:t,schemaId:e,articleId:o||this.curArticleList[0]._id,contentId:d})}},async setEditMeta(t,e,o,d){e||this.$alert({title:"缺少schemaId",showCancel:!1});const{MOCK:n}=process.env,c="new"!==o&&n?Object.values(this.schemaList)[0]:this.schemaList[e];console.info("setEditMeta",e);const{fields:r}=c,{tempObj:l,editTitle:h,list:f}=await this.initContent(o,r,d),v={...c,catalogId:t,editId:o,list:f,content:JSON.parse(JSON.stringify(l)),title:h},m=this.validEditMata(v);m?this.$alert({title:"editMeta的内容有错",content:m}):(this.editMeta=v,this.cusArticle=o)},async initContent(t,e,o){const{MOCK:d}=process.env;let n={},c="未命名",r=!1;return"new"===t?e&&e.length&&e.forEach(t=>{d&&"select"===t.type?n[t._id]=[]:n[t._id]=t.default?t.default:""}):(this.articles[t]||await this.getData(t),c=this.articles[t].title,r=this.articles[t].list,this.articles[t].contents&&this.articles[t].contents.length&&(n=o?this.articles[t].contents.find(t=>t._id===o):this.articles[t].contents[0])),{tempObj:n,editTitle:c,list:r}},validEditMata(data){const{editId:t,fields:e,_id:o,catalogId:d,title:title}=data;return t?title?Object.keys(e).length?o?d?null:"catalogId不能为空":"_id(article)不能为空":`fields无效:${JSON.stringify(e)}`:"title不能为空":"editId不能为空"},async getData(t,e=!1){this.editId=t,this.$showLoading();await this[c.ARTICLE_DES_GET]({_id:t,force:e});this.$hideLoading()},async getArticleByCatalogId(t){if(t===l.a.recentlyArticlesKey)return this.setArticleBrief(),void console.log("11");if(!this.curBook)return void this.$alert({content:"缺少bookId",showCancel:!1});this.$showLoading();const e=await this[c.ARTICLE_LIST_GET]({bookId:this.curBook,catalogId:t});return this.setArticleBrief(),this.$hideLoading(),e},setArticleBrief(){if(!Object.keys(this.articleList).length)return this.curArticleList=[],void(this.editMeta.editId="");const t=this.treeChainList[this.treeChainList.length-1],e=t===l.a.recentlyArticlesKey?l.a.recentlyArticlesKey:`${this.curBook}_${t}`,o=this.articleList[e];if(!o)return this.curArticleList=[],void(this.editMeta.editId="");console.log("getList",o),this.curArticleList=[...o]},async init(){this[n.CATALOGS_CUR_SAVE](l.a.recentlyArticlesKey),this.getBookData(),r.a.$on("emitToCreateArticle",t=>{this.doCreateArticle(t)}),r.a.$on("emitFromCatalog",t=>{const{isNew:e}=t;e?this.doCreateArticle(t):this.doShowArticleFromCatalog(t)}),r.a.$on("updateCurBooks",()=>{this[n.CATALOGS_CUR_SAVE](l.a.recentlyArticlesKey),this.getBookData()})}},mounted(){this.init()}};var S=Object(f.a)(O,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"flex flex-1"},[t._ssrNode("<div"+t._ssrClass("catalog-layout box-shadow",{"hidden-catalog":!t.showDir})+" data-v-db1218fc>","</div>",[o("TreeItem")],1),t._ssrNode(" "),o("ArticleBrief",{attrs:{list:t.curArticleList,cusArticle:t.cusArticle},on:{emitToChooseCurArticle:t.chooseCurArticle,emitInitArticle:t.doShowArticleFromCatalog}}),t._ssrNode(' <div class="flex-1"'+t._ssrStyle(null,null,{display:t.editMeta.editId?"none":""})+" data-v-db1218fc></div> "),o("articles",{directives:[{name:"show",rawName:"v-show",value:t.editMeta.editId,expression:"editMeta.editId"}],attrs:{editMeta:t.editMeta},on:{emitUpdateArticle:t.doUpdateArticle}}),t._ssrNode(" "),o("articleFixed")],2)},[],!1,function(t){var e=o(92);e.__inject__&&e.__inject__(t)},"db1218fc","aeae91c4");e.default=S.exports}};
//# sourceMappingURL=a80d94fd62d5f6a5b104.js.map